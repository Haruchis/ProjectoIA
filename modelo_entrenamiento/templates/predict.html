<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Predicción de PUNT_GLOBAL</title>
    <style>

        body { font-family: Arial, sans-serif; margin: 2rem; }
        .error { color: #a00; margin-top: 1rem; }
        table { border-collapse: collapse; margin-top: 1rem; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
        th { background-color: #f5f5f5; }
        button { padding: 0.6rem 1.2rem; margin-top: 1rem; cursor: pointer; }
        nav { margin-bottom: 1rem; }
        nav a { margin-right: 1rem; }

        body { 
            font-family: Arial, sans-serif; 
            margin: 2rem; 
            background-color: #f5f6fa;
        }
        nav { 
            margin-bottom: 1rem; 
        }
        nav a { 
            margin-right: 1rem; 
            text-decoration: none;
            color: #0066cc;
        }
        nav a:hover {
            text-decoration: underline;
        }
        h1 {
            margin-bottom: 0.5rem;
        }
        p {
            color: #444;
        }
        .error { 
            color: #a00; 
            margin-top: 1rem; 
            padding: 0.7rem 1rem;
            background-color: #ffe6e6;
            border: 1px solid #f5b5b5;
            border-radius: 4px;
        }
        table { 
            border-collapse: collapse; 
            margin-top: 1rem; 
            width: 100%; 
            background-color: #fff;
        }
        th, td { 
            border: 1px solid #ccc; 
            padding: 0.5rem; 
            text-align: left; 
        }
        th { 
            background-color: #f5f5f5; 
        }
        button { 
            padding: 0.6rem 1.2rem; 
            margin-top: 1rem; 
            cursor: pointer; 
            background-color: #0066cc;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-weight: 600;
        }
        button:hover {
            background-color: #0052a1;
        }
        .btn-secondary {
            background-color: #777;
        }
        .btn-secondary:hover {
            background-color: #555;
        }
        .buttons-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .preview-box {
            margin-top: 1.5rem;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 1rem;
        }

    </style>
</head>
<body>
    <nav>
        <a href="/train/">Entrenar</a>
        <a href="/predict/">Predecir</a>
    </nav>

    <h1>Generar predicciones</h1>

    <p>Cargue un archivo CSV o Excel con la misma estructura utilizada para el entrenamiento (sin la columna PUNT_GLOBAL).</p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="file" accept=".csv,.xlsx,.xls" required>
        <div>
            <button type="submit" name="action" value="preview">Mostrar vista previa</button>
            <button type="submit" name="action" value="download">Descargar CSV con predicciones</button>

    <p>
        Cargue un archivo <strong>CSV</strong> con la misma estructura utilizada para el entrenamiento
        (no es obligatorio que incluya la columna <code>PUNT_GLOBAL</code>).
        El sistema añadirá la columna <code>PREDICCION_PUNT_GLOBAL</code>.
    </p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="file" accept=".csv" required>

        <div class="buttons-row">
            <button type="submit" name="action" value="preview">
                Mostrar vista previa
            </button>
            <button type="submit" name="action" value="download" class="btn-secondary">
                Descargar CSV con predicciones
            </button>

        </div>
    </form>

    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    {% if has_predictions %}

        <h2>Vista previa de predicciones</h2>
        <div>{{ preview_table|safe }}</div>

        <div class="preview-box">
            <h2>Vista previa de predicciones (máx. 10 filas)</h2>
            <div>
                {{ preview_table|safe }}
            </div>
            <p style="color:#666; margin-top:0.5rem;">
                Para obtener el archivo completo con todas las filas y la columna
                <code>PREDICCION_PUNT_GLOBAL</code>, use el botón
                <strong>"Descargar CSV con predicciones"</strong>.
            </p>
        </div>

    {% endif %}
</body>
</html>
